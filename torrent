#!/bin/bash

function get_all_torrent_ids {
	transmission-remote --list | sed '1d;$d' | awk '{print $1}'
}

function add_trackers {
	trackers=$1
	if [ -z "$trackers" ]; then
		echo "Please specify trackers"
		exit 1
	fi

	get_all_torrent_ids | while read torrent; do
		for tracker in $trackers; do
			if [ -n "$tracker" ]; then
				result=$(transmission-remote --torrent $torrent --tracker-add $tracker)
				echo "$torrent: $tracker: $result"
			fi
		done
	done
}
function add_torrent {
	torrentlink=$1
	if [ -z "$torrentlink" ]; then
		echo "No torrent link specified"
		exit 1
	fi
	if ! [[ $torrentlink =~ ^magnet ]]; then
		echo "Invalid magnet link: $torrentlink"
		exit 1
	fi
	transmission-remote --add "$torrentlink"
	if [ $? -ne 0 ]; then
		echo "Failed to add torrent with link: $torrentlink"
		exit 1
	fi
}

case "$1" in
	list)
		transmission-remote --list	
		;;
	add)
		add_torrent "$2"	
		;;
	addtracker)
		add_trackers "$2" 
		;;
	*)
		echo "Invalid parameter"
		exit 2
		;;
esac

